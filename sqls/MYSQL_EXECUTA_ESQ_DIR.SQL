USE `dwsucos`;
DROP procedure IF EXISTS `SP_EXECUTA_ESQ_DIR`;

DELIMITER $$
USE `dwsucos`$$
CREATE DEFINER=`root`@`127.0.0.1` PROCEDURE `SP_EXECUTA_ESQ_DIR`()
BEGIN

SET @v_Contador = 1;
SET @v_Nivel = 1;
SET @v_Membros = (SELECT COUNT(*) FROM TEMP_AUXTABELA WHERE IDPAI = '' AND ESQ = 0);
WHILE @v_Membros > 0 DO

      SELECT ID INTO @v_Id FROM TEMP_AUXTABELA WHERE IDPAI = '' AND ESQ = 0 ORDER BY ID LIMIT 1;
      INSERT INTO TEMP_AUXCONTROLE (ID, CONTADOR, NIVEL) VALUES (@v_ID, @v_Contador, @v_Nivel);
	 
	  CALL SP_MONTAESQDIR;
	 
	 SET @v_Contador = (SELECT CONTADOR FROM TEMP_AUXCONTROLE ORDER BY POS DESC LIMIT 1);
     SET @v_Membros = (SELECT COUNT(*) FROM TEMP_AUXTABELA WHERE IDPAI = '' AND ESQ = 0); 
	 SET @v_Contador = @v_Contador + 1;
	   
END WHILE;
END$$

DELIMITER ;

